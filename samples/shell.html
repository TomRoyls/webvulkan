<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>WebVulkan</title>
    <style>
        body { margin: 0; background: #1a1a2e; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; font-family: system-ui; color: #ccc; }
        canvas { border: 1px solid #4a4a6a; background: #0f0f1a; }
        #status { margin-bottom: 10px; }
        #error { color: #ff6b6b; max-width: 80%; }
    </style>
</head>
<body>
    <div id="status">Loading...</div>
    <canvas id="canvas" width="800" height="600"></canvas>
    <div id="error" style="display:none;"></div>

    <script>
        async function initWebGPU() {
            if (!navigator.gpu) {
                throw new Error('WebGPU not supported');
            }
            const adapter = await navigator.gpu.requestAdapter();
            if (!adapter) throw new Error('No GPU adapter');
            const device = await adapter.requestDevice();
            return { adapter, device };
        }

        async function main() {
            const statusEl = document.getElementById('status');
            const errorEl = document.getElementById('error');
            const canvas = document.getElementById('canvas');
            
            try {
                statusEl.textContent = 'Initializing WebGPU...';
                const { adapter, device } = await initWebGPU();
                
                const context = canvas.getContext('webgpu');
                const format = navigator.gpu.getPreferredCanvasFormat();
                context.configure({ device, format, alphaMode: 'opaque' });
                
                statusEl.textContent = 'Loading WebAssembly...';
                
                Module = {
                    preinitializedWebGPUDevice: device,
                    canvas: canvas,
                    onRuntimeInitialized: () => {
                        statusEl.textContent = 'Running';
                    }
                };
                
                const script = document.createElement('script');
                script.src = 'triangle.js';
                document.body.appendChild(script);
                
            } catch (e) {
                statusEl.style.display = 'none';
                errorEl.style.display = 'block';
                errorEl.textContent = 'Error: ' + e.message;
            }
        }
        
        window.addEventListener('load', main);
    </script>
</body>
</html>
